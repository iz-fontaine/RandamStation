<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>東京メトロ駅ルーレット</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    h1 {
      text-align: center;
      margin: 20px 0;
      font-size: 1.5rem;
    }

    #result {
      font-size: 1.4rem;
      margin: 20px auto;
      font-weight: bold;
      text-align: center;
      max-width: 90%;
    }

    #history {
      max-width: 600px;
      width: 90%;
      margin: 0 auto;
      padding: 0 15px 10px;
      box-sizing: border-box;
    }

    #history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
      margin-bottom: 10px;
    }

    #history-header h2 {
      font-size: 1.1rem;
      margin: 0;
    }

    #clearText {
      font-size: 0.9rem;
      color: #007bff;
      cursor: pointer;
      user-select: none;
    }

    #copyPromptText {
      font-size: 0.9rem;
      color: #007bff;
      cursor: pointer;
      user-select: none;
    }
    

#history ul {
  list-style: none;
  padding: 0;
  margin: 0;
  height: 200px; /* 固定高さ（5件分目安） */
  overflow-y: auto; /* スクロール可能 */
  width: 100%;
  box-sizing: border-box;
}

    #history li {
      padding: 8px 0;
      border-bottom: 1px dashed #ddd;
      font-size: 0.95rem;
      word-break: break-word;
    }

    /* ボタン群 */
    .button-group {
      max-width: 600px;
      width: 90%;
      margin: 15px auto;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .button-group button {
      flex: 1;
      padding: 12px 0;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      color: white;
      min-width: 120px;
    }

    .start { background: #007bff; }
    .stop { background: #dc3545; }
    
    #startStopBtn {
      background-color: #007bff; /* 初期から青 */
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    #startStopBtn:hover {
      background-color: #0056b3;
}

    
    #generatePrompt { background: #28a745; }
    #copyPrompt { background: #ff9800; color: #000; }

    

    /* プロンプトテキスト */
#promptText {
  margin: 10px auto;
  width: 100%;
  max-width: 600px;
  height: 100px;
  padding: 8px;
  font-size: 14px;
  box-sizing: border-box;
  display: block; /* 最初から表示 */
  border: 1px solid #ccc;
  border-radius: 8px;
  background: #fff;
  resize: vertical;
}


    /* 結果と履歴・ボタンの間にスペース確保 */
    #result, #history, .button-group, #promptText {
      z-index: 1;
    }
  </style>
</head>
<body>

<h1>東京メトロ駅ルーレット</h1>
<div id="result">どこに行こー？</div>

<div id="history">
  <div id="history-header">
    <h2>履歴（最大5件）</h2>
    <span id="clearText">クリア</span>
  </div>
  <ul id="historyList"></ul>
</div>

<!-- ボタン群 -->
<!-- <div class="button-group">
  <button class="start" id="startBtn">Start</button>
  <button class="stop" id="stopBtn" disabled>Stop</button>
</div> -->

  <!-- スタート・ストップ共通ボタン -->
<div class="button-group">
  <button class="toggle" id="toggleBtn">Start</button>
</div>
  
<!-- プロンプト作成ボタン -->
<div class="button-group" style="margin-top:5px;">
  <button id="generatePrompt">プロンプト作成</button>
</div>

<div id="history">
  <div id="history-header">
    <h2>AI用プロンプト</h2>
    <span id="copyPromptText">コピー</span>
  </div>
  <textarea id="promptText" readonly></textarea>
  </div>
  
  
<script>
  let history = [];
  let stations = [];
  let intervalId = null;
  let currentStation = null;

  // JSON読み込み
  fetch("tokyo_metro_stations.json")
    .then(res => res.json())
    .then(data => {
      stations = data;
      console.log("駅データ読み込み完了:", stations.length);
    })
    .catch(err => console.error("JSON読み込みエラー:", err));

  const display = document.getElementById("result");
  const historyList = document.getElementById("historyList");
  const startBtn = document.getElementById("startBtn");
  const stopBtn = document.getElementById("stopBtn");
  const clearText = document.getElementById("clearText");
  const generatePromptBtn = document.getElementById("generatePrompt");
  const copyPromptBtn = document.getElementById("copyPrompt");
  const promptText = document.getElementById("promptText");

  // // Startボタン
  // startBtn.addEventListener("click", () => {
  //   if (stations.length === 0) return;
  //   startBtn.disabled = true;
  //   stopBtn.disabled = false;
  //   intervalId = setInterval(() => {
  //     const random = stations[Math.floor(Math.random() * stations.length)];
  //     currentStation = random;
  //     display.textContent = `${random.line} - ${random.station}`;
  //   }, 100);
  // });

  // // Stopボタン
  // stopBtn.addEventListener("click", () => {
  //   clearInterval(intervalId);
  //   startBtn.disabled = false;
  //   stopBtn.disabled = true;
  //   if (currentStation) {
  //     const stationText = `${currentStation.line} - ${currentStation.station}`;
  //     const li = document.createElement("li");
  //     li.textContent = stationText;
  //     historyList.appendChild(li);
  //     history.push(stationText);
  //     if(history.length > 5){
  //       history.shift();
  //       historyList.removeChild(historyList.firstChild);
  //     }
  //   }
  // });

const toggleBtn = document.getElementById("toggleBtn");
let isRunning = false;

toggleBtn.addEventListener("click", () => {
  if (!isRunning) {
    // スタート処理
    if (stations.length === 0) return;
    intervalId = setInterval(() => {
      const random = stations[Math.floor(Math.random() * stations.length)];
      currentStation = random;
      display.textContent = `${random.line} - ${random.station}`;
    }, 100);
    toggleBtn.textContent = "Stop";
    toggleBtn.classList.remove("start");
    toggleBtn.classList.add("stop");
    isRunning = true;
  } else {
    // ストップ処理
    clearInterval(intervalId);
    if (currentStation) {
      const li = document.createElement("li");
      li.textContent = `${currentStation.line} - ${currentStation.station}`;
      historyList.appendChild(li);
    }
    toggleBtn.textContent = "Start";
    toggleBtn.classList.remove("stop");
    toggleBtn.classList.add("start");
    isRunning = false;
  }
});
  
  // 履歴クリア
  clearText.addEventListener("click", () => {
    historyList.innerHTML = "";
    history = [];
    //promptText.style.display = "none";
  });

  // プロンプト生成
  generatePromptBtn.addEventListener("click", () => {
    if(history.length === 0){
      alert("履歴がありません");
      return;
    }

    const intro = `以下の条件に基づいて、観光案内を日本語とフランス語の二か国語で作成してください。

【内容】

・丸の内線荻窪駅をスタートとし、指定された駅をすべて巡るのに、最もスムーズな乗り換えルートを作成してください。
　→「オススメルート」欄に、日本語 → フランス語の順で記載してください。（時系列・各駅間の所要時間・順番がわかるようにしてください）。
・各駅ごとに、駅周辺の観光名所を3か所紹介してください。
　→それぞれの名所に、簡潔な説明をつけてください。
・可能であれば、その駅周辺でおすすめの名物グルメまたは名店を1つ紹介してください。
　→「★」印をつけて記載してください。
・各駅ごとの案内は、日本語 → フランス語の順で記載してください。
・路線名と駅名は、「日本語 / フランス語」の形式で記載してください。
　（例：日比谷線 - 茅場町 / Hibiya-sen - Kayabacho）

【回答フォーマット】

オススメルート：
〜〜線●●駅 →　（約~分） 〜〜線●●駅 → （約~分） 〜〜線●●駅 ・・・
~~~-sen - ~~~~　→ （~ min.）~~~-sen - ~~~~　→ （~ min.）・・・

【回答フォーマット】：
〜〜線●●駅 / ~~~-sen - ~~~~
1. 名所名：説明
2. 名所名：説明
3. 名所名：説明
★ 名物・名店：説明

履歴の駅：`;

    const stationList = history
      .map((station, i) => `${i + 1}. ${station}`)
      .join("\n");

    const fullPrompt = `${intro}\n${stationList}`;

    promptText.value = fullPrompt;
    promptText.style.display = "block";
  });

  // コピー
const copyPromptText = document.getElementById("copyPromptText");

copyPromptText.addEventListener("click", () => {
  if(promptText.value === "") return;
  promptText.select();
  document.execCommand("copy");
  //alert("プロンプトをコピーしました！");
});

</script>

</body>
</html>
